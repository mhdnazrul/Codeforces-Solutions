name: Update Archive & Deploy

on:
  push:
    branches: [ main ]
  workflow_dispatch: # ‡¶ó‡¶ø‡¶ü‡¶π‡¶æ‡¶¨ ‡¶•‡ßá‡¶ï‡ßá ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡ßü‡¶æ‡¶≤‡¶ø ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ö‡ßá‡¶™‡ßá ‡¶∞‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Ö‡¶™‡¶∂‡¶®

permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Dependencies
        run: pip install requests

      # ‡ßß. Python ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶∞‡¶æ‡¶® (‡¶´‡¶æ‡¶á‡¶≤ ‡¶∞‡¶ø‡¶®‡ßá‡¶Æ, JSON ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü, README ‡¶Ü‡¶™‡¶°‡ßá‡¶ü)
      - name: Run Generator Script
        run: python Web/generate.py

      # ‡ß®. ‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶∞‡¶æ‡¶û‡ßç‡¶ö‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ (‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá)
      # ‡¶è‡¶∞ ‡¶´‡¶≤‡ßá ‡¶°‡ßÅ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶ü ‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞ ‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶∞‡¶æ‡¶û‡ßç‡¶ö‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ
      - name: Commit and Push Changes to Main
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email '41898282+github-actions[bot]@users.noreply.github.com'
          git add .
          git commit -m "ü§ñ Auto-update: Renamed files & Updated Metadata" || echo "No changes to commit"
          git push

      # ‡ß©. ‡¶ì‡ßü‡ßá‡¶¨‡¶∏‡¶æ‡¶á‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶´‡¶æ‡¶á‡¶≤ ‡¶∞‡ßá‡¶°‡¶ø ‡¶ï‡¶∞‡¶æ (‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶°‡ßá‡¶™‡ßç‡¶≤‡ßü‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
      # ‡¶è‡¶á ‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞‡¶ó‡ßÅ‡¶≤‡ßã GitHub Pages ‡¶¨‡ßç‡¶∞‡¶æ‡¶û‡ßç‡¶ö‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá, ‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶∞‡¶æ‡¶û‡ßç‡¶ö‡ßá ‡¶®‡ßü
      - name: Prepare Files for Website
        run: |
          cp -r Solutions Web/ || true
          cp -r Gyms Web/ || true
          cp -r Groups Web/ || true

      # ‡ß™. ‡¶ì‡ßü‡ßá‡¶¨‡¶∏‡¶æ‡¶á‡¶ü ‡¶°‡ßá‡¶™‡ßç‡¶≤‡ßü ‡¶ï‡¶∞‡¶æ
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./Web
          force_orphan: true # gh-pages ‡¶¨‡ßç‡¶∞‡¶æ‡¶û‡ßç‡¶ö ‡¶ï‡ßç‡¶≤‡¶ø‡¶® ‡¶∞‡¶æ‡¶ñ‡¶¨‡ßá